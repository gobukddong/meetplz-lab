-- Seed Data for meetplz (Local Development)
-- Generated by Antigravity

-- Use a DO block to manage variables and logic
DO $$
DECLARE
  -- Define User UUIDs for consistency
  v_user1 UUID := '11111111-1111-1111-1111-111111111111';
  v_user2 UUID := '22222222-2222-2222-2222-222222222222';
  v_user3 UUID := '33333333-3333-3333-3333-333333333333';
  v_user4 UUID := '44444444-4444-4444-4444-444444444444';
  v_user5 UUID := '55555555-5555-5555-5555-555555555555';
  
  -- Meeting UUIDs
  v_meeting1 UUID := gen_random_uuid();
  v_meeting2 UUID := gen_random_uuid();
  v_meeting3 UUID := gen_random_uuid();
  v_meeting4 UUID := gen_random_uuid();
  v_meeting5 UUID := gen_random_uuid();
  v_meeting6 UUID := gen_random_uuid();
  v_meeting7 UUID := gen_random_uuid();
  v_meeting8 UUID := gen_random_uuid();
  v_meeting9 UUID := gen_random_uuid();
  v_meeting10 UUID := gen_random_uuid();

BEGIN
  -- 1. Insert into auth.users (Required for FK)
  -- Note: instance_id '00000000-0000-0000-0000-000000000000' is default for local supabase
  INSERT INTO auth.users (instance_id, id, aud, role, email, encrypted_password, email_confirmed_at, recovery_sent_at, last_sign_in_at, raw_app_meta_data, raw_user_meta_data, created_at, updated_at, confirmation_token, email_change, email_change_token_new, recovery_token)
  VALUES
    ('00000000-0000-0000-0000-000000000000', v_user1, 'authenticated', 'authenticated', 'chulsu@test.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{"name":"김철수"}', NOW(), NOW(), '', '', '', ''),
    ('00000000-0000-0000-0000-000000000000', v_user2, 'authenticated', 'authenticated', 'younghee@test.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{"name":"이영희"}', NOW(), NOW(), '', '', '', ''),
    ('00000000-0000-0000-0000-000000000000', v_user3, 'authenticated', 'authenticated', 'jimin@test.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{"name":"박지민"}', NOW(), NOW(), '', '', '', ''),
    ('00000000-0000-0000-0000-000000000000', v_user4, 'authenticated', 'authenticated', 'minjun@test.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{"name":"최민준"}', NOW(), NOW(), '', '', '', ''),
    ('00000000-0000-0000-0000-000000000000', v_user5, 'authenticated', 'authenticated', 'seo-yeon@test.com', crypt('password123', gen_salt('bf')), NOW(), NOW(), NOW(), '{"provider":"email","providers":["email"]}', '{"name":"정서연"}', NOW(), NOW(), '', '', '', '')
  ON CONFLICT (id) DO NOTHING;

  -- 2. Insert into profiles (Sync with auth.users)
  INSERT INTO public.profiles (id, email, name, avatar_url)
  VALUES
    (v_user1, 'chulsu@test.com', '김철수', 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix'),
    (v_user2, 'younghee@test.com', '이영희', 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka'),
    (v_user3, 'jimin@test.com', '박지민', 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jimin'),
    (v_user4, 'minjun@test.com', '최민준', 'https://api.dicebear.com/7.x/avataaars/svg?seed=Minjun'),
    (v_user5, 'seo-yeon@test.com', '정서연', 'https://api.dicebear.com/7.x/avataaars/svg?seed=Seoyeon')
  ON CONFLICT (id) DO NOTHING;

  -- 3. Insert Meetings (10 items)
  INSERT INTO public.meetings (id, host_id, title, description, location, meeting_at, status)
  VALUES
    -- Recruiting
    (v_meeting1, v_user1, '주말 강남역 코딩 스터디', 'Next.js 15 버전 같이 공부하실 분 구합니다. 초보자 환영!', '강남역 11번 출구 할리스', NOW() + INTERVAL '2 days', 'recruiting'),
    (v_meeting2, v_user2, '한강 러닝 크루 모집', '가볍게 5km 뛰고 치맥 하실 분?', '여의도 한강공원', NOW() + INTERVAL '1 day', 'recruiting'),
    (v_meeting3, v_user3, '판교 점심 커피챗', '판교 직장인들끼리 점심에 가볍게 인사 나눠요.', '아브뉴프랑 스벅', NOW() + INTERVAL '5 hours', 'recruiting'),
    (v_meeting4, v_user1, '홍대 맛집 탐방대', '새로 오픈한 일식집 같이 가실 분 선착순 3명', '홍대입구역 3번 출구', NOW() + INTERVAL '3 days', 'recruiting'),
    
    -- Confirmed
    (v_meeting5, v_user4, '사이드 프로젝트 기획 회의', '기획안 마무리 단계입니다. 필참 부탁드려요.', '온라인 (Zoom)', NOW() + INTERVAL '1 week', 'confirmed'),
    (v_meeting6, v_user5, '토요일 아침 독서 모임', '각자 읽은 책 소개하는 시간입니다.', '광화문 교보문고', NOW() + INTERVAL '4 days', 'confirmed'),
    (v_meeting7, v_user2, '주말 등산 - 관악산', '정상 찍고 막걸리 한 잔!', '서울대입구역', NOW() + INTERVAL '12 hours', 'confirmed'),
    
    -- Completed / Cancelled
    (v_meeting8, v_user3, '지난주 회고 미팅', '지난주 스프린트 리뷰 진행했습니다.', '사무실', NOW() - INTERVAL '3 days', 'completed'),
    (v_meeting9, v_user4, '급벙 - 영화 보러 가실 분', '파묘 보러 가실 분 구해요', '용산 CGV', NOW() - INTERVAL '1 day', 'completed'),
    (v_meeting10, v_user5, '비 오는 날 파전 번개', '비가 와서 취소되었습니다 ㅠㅠ', '회기역 파전골목', NOW() - INTERVAL '2 days', 'cancelled')
  ON CONFLICT (id) DO NOTHING;

  -- 4. Insert Participants (Triggers will create personal_tasks automatically)
  -- Note: Host is not automatically a participant table row usually, but strictly speaking host attends. 
  -- Whether host needs to be in participants table depends on logic, assume yes for 'My Schedule' visibility if logic requires it.
  -- Adding logic: Host + 1~2 Random Users per meeting
  
  -- Meeting 1 (Recruiting) - Host: User1
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting1, v_user1, 'joined');
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting1, v_user2, 'joined');

  -- Meeting 2 (Recruiting) - Host: User2
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting2, v_user2, 'joined');
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting3, v_user4, 'joined'); -- Typo in comment but logic ok

  -- Meeting 3 (Recruiting) - Host: User3
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting3, v_user3, 'joined');
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting3, v_user1, 'joined');
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting3, v_user5, 'joined');

  -- Meeting 5 (Confirmed) - Host: User4
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting5, v_user4, 'joined');
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting5, v_user1, 'joined');
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting5, v_user2, 'joined');
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting5, v_user3, 'joined');

  -- Meeting 6 (Confirmed) - Host: User5
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting6, v_user5, 'joined');
  INSERT INTO public.participants (meeting_id, user_id, status) VALUES (v_meeting6, v_user2, 'joined');

  -- 5. Insert Personal Tasks (Manual Personal To-Dos)
  INSERT INTO public.personal_tasks (user_id, content, due_date, is_public, source, is_completed)
  VALUES
    (v_user1, '개인 운동하기', CURRENT_DATE, false, 'personal', false),
    (v_user1, '장보기 (우유, 계란)', CURRENT_DATE + 1, false, 'personal', false),
    (v_user1, '블로그 글 쓰기', CURRENT_DATE, true, 'personal', true),
    
    (v_user2, '치과 예약', CURRENT_DATE + 3, false, 'personal', false),
    (v_user2, '영어 단어 암기', CURRENT_DATE, true, 'personal', false),
    
    (v_user3, '프로젝트 리팩토링', CURRENT_DATE, true, 'personal', true),
    (v_user3, '어머니 생신 선물 사기', CURRENT_DATE + 2, false, 'personal', false);

END $$;
